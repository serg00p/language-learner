<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Word Trainer</title>
<style>
body { font-family: Arial, sans-serif; background:#f0f2f5; display:flex; flex-direction:column; justify-content:center; align-items:center; min-height:100vh; margin:0; }
#language-buttons, #level-buttons, #article-buttons { text-align:center; margin:10px 0; }
#language-buttons button, #level-buttons button, #article-buttons button { margin:5px; padding:8px 16px; font-size:16px; border:none; border-radius:5px; cursor:pointer; background:#2196F3; color:white; }
#language-buttons button.active, #level-buttons button.active, #article-buttons button.selected { box-shadow:0 0 10px #666; background-color: #4CAF50;}
.container { text-align:center; background:#fff; padding:20px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.2); width:350px; }
#progress-container { width:100%; background:#ddd; border-radius:5px; margin-bottom:10px; height:20px; overflow:hidden; }
#progress-bar { height:100%; width:0; background:#4CAF50; border-radius:5px; transition: width 0.3s ease; }
.word { font-size:24px; font-weight:bold; margin-bottom:10px; }
input { font-size:18px; padding:5px; border:2px solid #ccc; border-radius:5px; text-align:center; width:100%; box-sizing:border-box; }
button.check { margin-top:10px; padding:10px 20px; font-size:16px; border:none; border-radius:5px; cursor:pointer; background:#4CAF50; color:white; }
.popup { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:white; padding:20px; border-radius:10px; box-shadow:0 4px 8px rgba(0,0,0,0.2); text-align:center; width:300px; z-index:1000; }
.popup.correct { border:2px solid #4CAF50; }
.popup.wrong { border:2px solid #ff4d4d; }
.popup.completed { border:2px solid #4CAF50; }
.close-btn { margin-top:10px; padding:5px 10px; border:none; background:#007bff; color:white; border-radius:5px; cursor:pointer; }
</style>
</head>
<body>

<div id="language-buttons">
  <button id="english-btn">English</button>
  <button id="german-btn">German</button>
</div>

<div id="level-buttons"></div>
<div id="article-buttons">
  <button data-article="der">Der</button>
  <button data-article="die">Die</button>
  <button data-article="das">Das</button>
</div>

<div class="container">
  <h1>Word Trainer</h1>
  <div id="progress-container"><div id="progress-bar"></div></div>
  <div class="word" id="word"></div>
  <input type="text" id="answer" maxlength="30" placeholder="Type your answer">
  <br>
  <button class="check" onclick="checkAndNextWord()">Check & Next</button>
</div>

<div id="popup" class="popup">
  <p id="popup-message"></p>
  <button class="close-btn" onclick="closePopup()">Close</button>
</div>

<audio id="correctSound" src="https://www.myinstants.com/media/sounds/correct.mp3"></audio>
<audio id="wrongSound" src="https://www.myinstants.com/media/sounds/wrong.mp3"></audio>

<script>
let allLevels = [];
let currentLevelIndex = null;
let currentLevelWords = [];
let remainingWords = [];
let wrongWords = [];
let currentWord = {};
let currentLanguage = "english";
let selectedArticle = null;

const languageButtons = {
  english: document.getElementById("english-btn"),
  german: document.getElementById("german-btn")
};
const levelButtonsContainer = document.getElementById("level-buttons");
const articleButtons = Array.from(document.querySelectorAll("#article-buttons button"));
const popup = document.getElementById("popup");
const popupMessage = document.getElementById("popup-message");
const closeBtn = popup.querySelector(".close-btn");

async function loadWords(language){
  currentLanguage = language;
  selectedArticle = null;
  articleButtons.forEach(b=>b.classList.remove("selected"));
  
  // Load JSON for selected language
  allLevels = language==="english"? await fetch('english_words.json').then(r=>r.json())
                                  : await fetch('german_words.json').then(r=>r.json());
  
  createLevelButtons();
  highlightLanguageButton();

  // Reset current level selection and progress
  currentLevelIndex = null;
  currentLevelWords = [];
  remainingWords = [];
  wrongWords = [];
  document.getElementById("word").innerText = "";
  document.getElementById("answer").value = "";
  updateProgressBar();
  updateLevelButtons(); // remove highlights
  toggleArticleButtons(false);
}

function createLevelButtons(){
  levelButtonsContainer.innerHTML = "";
  allLevels.forEach((lvl,i)=>{
    const btn = document.createElement("button");
    btn.textContent = lvl.name;
    btn.onclick = ()=>selectLevel(i, currentLevelIndex!==i);
    levelButtonsContainer.appendChild(btn);
  });
}

function highlightLanguageButton(){
  languageButtons.english.classList.toggle("active", currentLanguage==="english");
  languageButtons.german.classList.toggle("active", currentLanguage==="german");
}

function selectLevel(index, allowReset=true){
  if(currentLevelIndex===index && !allowReset) return;
  currentLevelIndex = index;
  currentLevelWords = [...allLevels[index].words];
  remainingWords = [...currentLevelWords];
  wrongWords = [];
  currentWord = {};
  selectedArticle = null;
  articleButtons.forEach(b=>b.classList.remove("selected"));
  updateLevelButtons();
  displayNewWord();
  updateProgressBar();
}

function updateLevelButtons(){
  Array.from(levelButtonsContainer.children).forEach((btn,i)=>{
    btn.classList.toggle("active", i===currentLevelIndex);
  });
}

articleButtons.forEach(b=>{
  b.onclick = ()=>{
    selectedArticle = b.dataset.article;
    articleButtons.forEach(btn=>btn.classList.remove("selected"));
    b.classList.add("selected");
  };
});

function toggleArticleButtons(show){
  document.getElementById("article-buttons").style.display = show?"block":"none";
}

function getNextWord(){
  if(remainingWords.length===0) return null;
  const index = Math.floor(Math.random()*remainingWords.length);
  return remainingWords[index];
}

function displayNewWord(){
  if(remainingWords.length===0){ showLevelComplete(); return; }
  currentWord = getNextWord();
  document.getElementById("word").innerText = currentWord.uk;
  document.getElementById("answer").value = "";
  selectedArticle = null;
  articleButtons.forEach(b=>b.classList.remove("selected"));
  toggleArticleButtons(currentLanguage==="german" && currentWord.requiresArticle);
}

function updateProgressBar(){
  const completed = currentLevelWords.length - remainingWords.length;
  const percent = currentLevelWords.length ? (completed/currentLevelWords.length*100) : 0;
  document.getElementById("progress-bar").style.width = percent+"%";
}

function checkAndNextWord(){
  if(!currentWord) return;

  let userInput = document.getElementById("answer").value.trim().toLowerCase();
  if(currentLanguage==="german" && currentWord.requiresArticle && selectedArticle){
    userInput = selectedArticle + " " + userInput;
  }

  if(userInput === currentWord.en.toLowerCase()){
    document.getElementById("correctSound").play();
    // remove word from remainingWords
    remainingWords = remainingWords.filter(w=>w!==currentWord);
    updateProgressBar();
    displayNewWord();
  } else {
    document.getElementById("wrongSound").play();
    if(!wrongWords.includes(currentWord.uk)) wrongWords.push(currentWord.uk);
  }
}

function showLevelComplete(){
  popupMessage.innerText = `Level ${allLevels[currentLevelIndex].name} complete!\n` + 
                           (wrongWords.length ? "Review: "+wrongWords.join(", ") : "All correct!");
  popup.className="popup completed";

  closeBtn.innerText = "Restart Level";
  closeBtn.onclick = ()=>{
    popup.style.display="none";
    selectLevel(currentLevelIndex, true);
  };
  popup.style.display="block";
}

function closePopup(){
  popup.style.display="none";
  popup.className="popup";
}

languageButtons.english.onclick = ()=>loadWords("english");
languageButtons.german.onclick = ()=>loadWords("german");

// Load English by default
window.onload = ()=>loadWords("english");
</script>

</body>
</html>
